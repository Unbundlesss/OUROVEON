//   _______ _______ ______ _______ ___ ___ _______ _______ _______ 
//  |       |   |   |   __ \       |   |   |    ___|       |    |  |
//  |   -   |   |   |      <   -   |   |   |    ___|   -   |       |
//  |_______|_______|___|__|_______|\_____/|_______|_______|__|____|
//  ishani.org 2022              e.t.c.                  MIT License
//

/*=============================================================================
   Copyright (C) 2006 by Volodymyr Myrnyy (Vladimir Mirnyi)

   Permission to use, copy, modify, distribute and sell this software for any
   purpose is hereby granted without fee, provided that the above copyright
   notice appear in all copies and that both that copyright notice and this
   permission notice appear in supporting documentation.

   Generic simple and efficient Fast Fourier Transform (FFT) implementation
   using template metaprogramming

   http://www.drdobbs.com/cpp/a-simple-and-efficient-fft-implementatio/199500857

   A new efficient implementation of the Cooley-Tukey fast Fourier transform
   (FFT) algorithm using C++ template metaprogramming. Thanks to the
   recursive nature of the FFT, the source code is more readable and faster
   than the classical implementation. The efficiency is proved by performance
   benchmarks on different platforms.
=============================================================================*/
#pragma once

#include "dsp/types.h"

// contains some edits. targets float, some unrolling experiments for speed to try and catch KISS

namespace dsp
{
    namespace detail
    {
        // The sine and cosine values calculated using series expansion
        constexpr float sin_cos_series( unsigned M, unsigned N, unsigned B, unsigned A )
        {
            return (M == N) ? 1.0f :
                1 - (A * constants::f_pi / B) *
                    (A * constants::f_pi / B) /
                     M /
                    (M + 1) * sin_cos_series( M + 2, N, B, A );
        };

        constexpr float __sin( unsigned B, unsigned A )
        {
            return (A * constants::f_pi / B) * sin_cos_series( 2, 34, B, A );
        }

        constexpr float __cos( unsigned B, unsigned A )
        {
            return sin_cos_series( 1, 33, B, A );
        }

        template <std::size_t N>
        struct danielson_lanczos
        {
            danielson_lanczos<N / 2> next;

            static constexpr auto sina = -__sin( N, 1 );
            static constexpr auto sinb = -__sin( N, 2 );

            inline void apply( float* data )
            {
                next.apply( data );
                next.apply( data + N );

                float wtemp = sina;
                const float wpr = -2.0f * wtemp * wtemp;
                const float wpi = sinb;
                float wr = 1.0f;
                float wi = 0.0f;
                for ( std::size_t i = 0; i < N; i += 2 )
                {
                    const float tempr = data[i + N] * wr - data[i + N + 1] * wi;
                    const float tempi = data[i + N] * wi + data[i + N + 1] * wr;
                    data[i + N] = data[i] - tempr;
                    data[i + N + 1] = data[i + 1] - tempi;
                    data[i] += tempr;
                    data[i + 1] += tempi;

                    wtemp = wr;
                    wr += wr * wpr - wi * wpi;
                    wi += wi * wpr + wtemp * wpi;
                }
            }
        };

        template <>
        struct danielson_lanczos<4>
        {
            inline void apply( float* data )
            {
                float tr = data[2];
                float ti = data[3];
                data[2] = data[0] - tr;
                data[3] = data[1] - ti;
                data[0] += tr;
                data[1] += ti;
                tr = data[6];
                ti = data[7];
                data[6] = data[5] - ti;
                data[7] = tr - data[4];
                data[4] += tr;
                data[5] += ti;

                tr = data[4];
                ti = data[5];
                data[4] = data[0] - tr;
                data[5] = data[1] - ti;
                data[0] += tr;
                data[1] += ti;
                tr = data[6];
                ti = data[7];
                data[6] = data[2] - tr;
                data[7] = data[3] - ti;
                data[2] += tr;
                data[3] += ti;
            }
        };

        template <>
        struct danielson_lanczos<2>
        {
            inline void apply( float* data )
            {
                float tr = data[2];
                float ti = data[3];
                data[2] = data[0] - tr;
                data[3] = data[1] - ti;
                data[0] += tr;
                data[1] += ti;
            }
        };
        
        template <std::size_t N>
        inline void scramble( float* data )
        {
            int j = 1;
            for ( int i = 1; i < 2 * N; i += 2 )
            {
                if ( j > i )
                {
                    std::swap( data[j - 1], data[i - 1] );
                    std::swap( data[j], data[i] );
                }
                int m = N;
                while ( m >= 2 && j > m )
                {
                    j -= m;
                    m >>= 1;
                }
                j += m;
            }
        }

        template<>
        inline void scramble<1024>( float* data )
        {
            std::swap( data[1024], data[2] );
            std::swap( data[1025], data[3] );
            std::swap( data[512], data[4] );
            std::swap( data[513], data[5] );
            std::swap( data[1536], data[6] );
            std::swap( data[1537], data[7] );
            std::swap( data[256], data[8] );
            std::swap( data[257], data[9] );
            std::swap( data[1280], data[10] );
            std::swap( data[1281], data[11] );
            std::swap( data[768], data[12] );
            std::swap( data[769], data[13] );
            std::swap( data[1792], data[14] );
            std::swap( data[1793], data[15] );
            std::swap( data[128], data[16] );
            std::swap( data[129], data[17] );
            std::swap( data[1152], data[18] );
            std::swap( data[1153], data[19] );
            std::swap( data[640], data[20] );
            std::swap( data[641], data[21] );
            std::swap( data[1664], data[22] );
            std::swap( data[1665], data[23] );
            std::swap( data[384], data[24] );
            std::swap( data[385], data[25] );
            std::swap( data[1408], data[26] );
            std::swap( data[1409], data[27] );
            std::swap( data[896], data[28] );
            std::swap( data[897], data[29] );
            std::swap( data[1920], data[30] );
            std::swap( data[1921], data[31] );
            std::swap( data[64], data[32] );
            std::swap( data[65], data[33] );
            std::swap( data[1088], data[34] );
            std::swap( data[1089], data[35] );
            std::swap( data[576], data[36] );
            std::swap( data[577], data[37] );
            std::swap( data[1600], data[38] );
            std::swap( data[1601], data[39] );
            std::swap( data[320], data[40] );
            std::swap( data[321], data[41] );
            std::swap( data[1344], data[42] );
            std::swap( data[1345], data[43] );
            std::swap( data[832], data[44] );
            std::swap( data[833], data[45] );
            std::swap( data[1856], data[46] );
            std::swap( data[1857], data[47] );
            std::swap( data[192], data[48] );
            std::swap( data[193], data[49] );
            std::swap( data[1216], data[50] );
            std::swap( data[1217], data[51] );
            std::swap( data[704], data[52] );
            std::swap( data[705], data[53] );
            std::swap( data[1728], data[54] );
            std::swap( data[1729], data[55] );
            std::swap( data[448], data[56] );
            std::swap( data[449], data[57] );
            std::swap( data[1472], data[58] );
            std::swap( data[1473], data[59] );
            std::swap( data[960], data[60] );
            std::swap( data[961], data[61] );
            std::swap( data[1984], data[62] );
            std::swap( data[1985], data[63] );
            std::swap( data[1056], data[66] );
            std::swap( data[1057], data[67] );
            std::swap( data[544], data[68] );
            std::swap( data[545], data[69] );
            std::swap( data[1568], data[70] );
            std::swap( data[1569], data[71] );
            std::swap( data[288], data[72] );
            std::swap( data[289], data[73] );
            std::swap( data[1312], data[74] );
            std::swap( data[1313], data[75] );
            std::swap( data[800], data[76] );
            std::swap( data[801], data[77] );
            std::swap( data[1824], data[78] );
            std::swap( data[1825], data[79] );
            std::swap( data[160], data[80] );
            std::swap( data[161], data[81] );
            std::swap( data[1184], data[82] );
            std::swap( data[1185], data[83] );
            std::swap( data[672], data[84] );
            std::swap( data[673], data[85] );
            std::swap( data[1696], data[86] );
            std::swap( data[1697], data[87] );
            std::swap( data[416], data[88] );
            std::swap( data[417], data[89] );
            std::swap( data[1440], data[90] );
            std::swap( data[1441], data[91] );
            std::swap( data[928], data[92] );
            std::swap( data[929], data[93] );
            std::swap( data[1952], data[94] );
            std::swap( data[1953], data[95] );
            std::swap( data[1120], data[98] );
            std::swap( data[1121], data[99] );
            std::swap( data[608], data[100] );
            std::swap( data[609], data[101] );
            std::swap( data[1632], data[102] );
            std::swap( data[1633], data[103] );
            std::swap( data[352], data[104] );
            std::swap( data[353], data[105] );
            std::swap( data[1376], data[106] );
            std::swap( data[1377], data[107] );
            std::swap( data[864], data[108] );
            std::swap( data[865], data[109] );
            std::swap( data[1888], data[110] );
            std::swap( data[1889], data[111] );
            std::swap( data[224], data[112] );
            std::swap( data[225], data[113] );
            std::swap( data[1248], data[114] );
            std::swap( data[1249], data[115] );
            std::swap( data[736], data[116] );
            std::swap( data[737], data[117] );
            std::swap( data[1760], data[118] );
            std::swap( data[1761], data[119] );
            std::swap( data[480], data[120] );
            std::swap( data[481], data[121] );
            std::swap( data[1504], data[122] );
            std::swap( data[1505], data[123] );
            std::swap( data[992], data[124] );
            std::swap( data[993], data[125] );
            std::swap( data[2016], data[126] );
            std::swap( data[2017], data[127] );
            std::swap( data[1040], data[130] );
            std::swap( data[1041], data[131] );
            std::swap( data[528], data[132] );
            std::swap( data[529], data[133] );
            std::swap( data[1552], data[134] );
            std::swap( data[1553], data[135] );
            std::swap( data[272], data[136] );
            std::swap( data[273], data[137] );
            std::swap( data[1296], data[138] );
            std::swap( data[1297], data[139] );
            std::swap( data[784], data[140] );
            std::swap( data[785], data[141] );
            std::swap( data[1808], data[142] );
            std::swap( data[1809], data[143] );
            std::swap( data[1168], data[146] );
            std::swap( data[1169], data[147] );
            std::swap( data[656], data[148] );
            std::swap( data[657], data[149] );
            std::swap( data[1680], data[150] );
            std::swap( data[1681], data[151] );
            std::swap( data[400], data[152] );
            std::swap( data[401], data[153] );
            std::swap( data[1424], data[154] );
            std::swap( data[1425], data[155] );
            std::swap( data[912], data[156] );
            std::swap( data[913], data[157] );
            std::swap( data[1936], data[158] );
            std::swap( data[1937], data[159] );
            std::swap( data[1104], data[162] );
            std::swap( data[1105], data[163] );
            std::swap( data[592], data[164] );
            std::swap( data[593], data[165] );
            std::swap( data[1616], data[166] );
            std::swap( data[1617], data[167] );
            std::swap( data[336], data[168] );
            std::swap( data[337], data[169] );
            std::swap( data[1360], data[170] );
            std::swap( data[1361], data[171] );
            std::swap( data[848], data[172] );
            std::swap( data[849], data[173] );
            std::swap( data[1872], data[174] );
            std::swap( data[1873], data[175] );
            std::swap( data[208], data[176] );
            std::swap( data[209], data[177] );
            std::swap( data[1232], data[178] );
            std::swap( data[1233], data[179] );
            std::swap( data[720], data[180] );
            std::swap( data[721], data[181] );
            std::swap( data[1744], data[182] );
            std::swap( data[1745], data[183] );
            std::swap( data[464], data[184] );
            std::swap( data[465], data[185] );
            std::swap( data[1488], data[186] );
            std::swap( data[1489], data[187] );
            std::swap( data[976], data[188] );
            std::swap( data[977], data[189] );
            std::swap( data[2000], data[190] );
            std::swap( data[2001], data[191] );
            std::swap( data[1072], data[194] );
            std::swap( data[1073], data[195] );
            std::swap( data[560], data[196] );
            std::swap( data[561], data[197] );
            std::swap( data[1584], data[198] );
            std::swap( data[1585], data[199] );
            std::swap( data[304], data[200] );
            std::swap( data[305], data[201] );
            std::swap( data[1328], data[202] );
            std::swap( data[1329], data[203] );
            std::swap( data[816], data[204] );
            std::swap( data[817], data[205] );
            std::swap( data[1840], data[206] );
            std::swap( data[1841], data[207] );
            std::swap( data[1200], data[210] );
            std::swap( data[1201], data[211] );
            std::swap( data[688], data[212] );
            std::swap( data[689], data[213] );
            std::swap( data[1712], data[214] );
            std::swap( data[1713], data[215] );
            std::swap( data[432], data[216] );
            std::swap( data[433], data[217] );
            std::swap( data[1456], data[218] );
            std::swap( data[1457], data[219] );
            std::swap( data[944], data[220] );
            std::swap( data[945], data[221] );
            std::swap( data[1968], data[222] );
            std::swap( data[1969], data[223] );
            std::swap( data[1136], data[226] );
            std::swap( data[1137], data[227] );
            std::swap( data[624], data[228] );
            std::swap( data[625], data[229] );
            std::swap( data[1648], data[230] );
            std::swap( data[1649], data[231] );
            std::swap( data[368], data[232] );
            std::swap( data[369], data[233] );
            std::swap( data[1392], data[234] );
            std::swap( data[1393], data[235] );
            std::swap( data[880], data[236] );
            std::swap( data[881], data[237] );
            std::swap( data[1904], data[238] );
            std::swap( data[1905], data[239] );
            std::swap( data[1264], data[242] );
            std::swap( data[1265], data[243] );
            std::swap( data[752], data[244] );
            std::swap( data[753], data[245] );
            std::swap( data[1776], data[246] );
            std::swap( data[1777], data[247] );
            std::swap( data[496], data[248] );
            std::swap( data[497], data[249] );
            std::swap( data[1520], data[250] );
            std::swap( data[1521], data[251] );
            std::swap( data[1008], data[252] );
            std::swap( data[1009], data[253] );
            std::swap( data[2032], data[254] );
            std::swap( data[2033], data[255] );
            std::swap( data[1032], data[258] );
            std::swap( data[1033], data[259] );
            std::swap( data[520], data[260] );
            std::swap( data[521], data[261] );
            std::swap( data[1544], data[262] );
            std::swap( data[1545], data[263] );
            std::swap( data[1288], data[266] );
            std::swap( data[1289], data[267] );
            std::swap( data[776], data[268] );
            std::swap( data[777], data[269] );
            std::swap( data[1800], data[270] );
            std::swap( data[1801], data[271] );
            std::swap( data[1160], data[274] );
            std::swap( data[1161], data[275] );
            std::swap( data[648], data[276] );
            std::swap( data[649], data[277] );
            std::swap( data[1672], data[278] );
            std::swap( data[1673], data[279] );
            std::swap( data[392], data[280] );
            std::swap( data[393], data[281] );
            std::swap( data[1416], data[282] );
            std::swap( data[1417], data[283] );
            std::swap( data[904], data[284] );
            std::swap( data[905], data[285] );
            std::swap( data[1928], data[286] );
            std::swap( data[1929], data[287] );
            std::swap( data[1096], data[290] );
            std::swap( data[1097], data[291] );
            std::swap( data[584], data[292] );
            std::swap( data[585], data[293] );
            std::swap( data[1608], data[294] );
            std::swap( data[1609], data[295] );
            std::swap( data[328], data[296] );
            std::swap( data[329], data[297] );
            std::swap( data[1352], data[298] );
            std::swap( data[1353], data[299] );
            std::swap( data[840], data[300] );
            std::swap( data[841], data[301] );
            std::swap( data[1864], data[302] );
            std::swap( data[1865], data[303] );
            std::swap( data[1224], data[306] );
            std::swap( data[1225], data[307] );
            std::swap( data[712], data[308] );
            std::swap( data[713], data[309] );
            std::swap( data[1736], data[310] );
            std::swap( data[1737], data[311] );
            std::swap( data[456], data[312] );
            std::swap( data[457], data[313] );
            std::swap( data[1480], data[314] );
            std::swap( data[1481], data[315] );
            std::swap( data[968], data[316] );
            std::swap( data[969], data[317] );
            std::swap( data[1992], data[318] );
            std::swap( data[1993], data[319] );
            std::swap( data[1064], data[322] );
            std::swap( data[1065], data[323] );
            std::swap( data[552], data[324] );
            std::swap( data[553], data[325] );
            std::swap( data[1576], data[326] );
            std::swap( data[1577], data[327] );
            std::swap( data[1320], data[330] );
            std::swap( data[1321], data[331] );
            std::swap( data[808], data[332] );
            std::swap( data[809], data[333] );
            std::swap( data[1832], data[334] );
            std::swap( data[1833], data[335] );
            std::swap( data[1192], data[338] );
            std::swap( data[1193], data[339] );
            std::swap( data[680], data[340] );
            std::swap( data[681], data[341] );
            std::swap( data[1704], data[342] );
            std::swap( data[1705], data[343] );
            std::swap( data[424], data[344] );
            std::swap( data[425], data[345] );
            std::swap( data[1448], data[346] );
            std::swap( data[1449], data[347] );
            std::swap( data[936], data[348] );
            std::swap( data[937], data[349] );
            std::swap( data[1960], data[350] );
            std::swap( data[1961], data[351] );
            std::swap( data[1128], data[354] );
            std::swap( data[1129], data[355] );
            std::swap( data[616], data[356] );
            std::swap( data[617], data[357] );
            std::swap( data[1640], data[358] );
            std::swap( data[1641], data[359] );
            std::swap( data[1384], data[362] );
            std::swap( data[1385], data[363] );
            std::swap( data[872], data[364] );
            std::swap( data[873], data[365] );
            std::swap( data[1896], data[366] );
            std::swap( data[1897], data[367] );
            std::swap( data[1256], data[370] );
            std::swap( data[1257], data[371] );
            std::swap( data[744], data[372] );
            std::swap( data[745], data[373] );
            std::swap( data[1768], data[374] );
            std::swap( data[1769], data[375] );
            std::swap( data[488], data[376] );
            std::swap( data[489], data[377] );
            std::swap( data[1512], data[378] );
            std::swap( data[1513], data[379] );
            std::swap( data[1000], data[380] );
            std::swap( data[1001], data[381] );
            std::swap( data[2024], data[382] );
            std::swap( data[2025], data[383] );
            std::swap( data[1048], data[386] );
            std::swap( data[1049], data[387] );
            std::swap( data[536], data[388] );
            std::swap( data[537], data[389] );
            std::swap( data[1560], data[390] );
            std::swap( data[1561], data[391] );
            std::swap( data[1304], data[394] );
            std::swap( data[1305], data[395] );
            std::swap( data[792], data[396] );
            std::swap( data[793], data[397] );
            std::swap( data[1816], data[398] );
            std::swap( data[1817], data[399] );
            std::swap( data[1176], data[402] );
            std::swap( data[1177], data[403] );
            std::swap( data[664], data[404] );
            std::swap( data[665], data[405] );
            std::swap( data[1688], data[406] );
            std::swap( data[1689], data[407] );
            std::swap( data[1432], data[410] );
            std::swap( data[1433], data[411] );
            std::swap( data[920], data[412] );
            std::swap( data[921], data[413] );
            std::swap( data[1944], data[414] );
            std::swap( data[1945], data[415] );
            std::swap( data[1112], data[418] );
            std::swap( data[1113], data[419] );
            std::swap( data[600], data[420] );
            std::swap( data[601], data[421] );
            std::swap( data[1624], data[422] );
            std::swap( data[1625], data[423] );
            std::swap( data[1368], data[426] );
            std::swap( data[1369], data[427] );
            std::swap( data[856], data[428] );
            std::swap( data[857], data[429] );
            std::swap( data[1880], data[430] );
            std::swap( data[1881], data[431] );
            std::swap( data[1240], data[434] );
            std::swap( data[1241], data[435] );
            std::swap( data[728], data[436] );
            std::swap( data[729], data[437] );
            std::swap( data[1752], data[438] );
            std::swap( data[1753], data[439] );
            std::swap( data[472], data[440] );
            std::swap( data[473], data[441] );
            std::swap( data[1496], data[442] );
            std::swap( data[1497], data[443] );
            std::swap( data[984], data[444] );
            std::swap( data[985], data[445] );
            std::swap( data[2008], data[446] );
            std::swap( data[2009], data[447] );
            std::swap( data[1080], data[450] );
            std::swap( data[1081], data[451] );
            std::swap( data[568], data[452] );
            std::swap( data[569], data[453] );
            std::swap( data[1592], data[454] );
            std::swap( data[1593], data[455] );
            std::swap( data[1336], data[458] );
            std::swap( data[1337], data[459] );
            std::swap( data[824], data[460] );
            std::swap( data[825], data[461] );
            std::swap( data[1848], data[462] );
            std::swap( data[1849], data[463] );
            std::swap( data[1208], data[466] );
            std::swap( data[1209], data[467] );
            std::swap( data[696], data[468] );
            std::swap( data[697], data[469] );
            std::swap( data[1720], data[470] );
            std::swap( data[1721], data[471] );
            std::swap( data[1464], data[474] );
            std::swap( data[1465], data[475] );
            std::swap( data[952], data[476] );
            std::swap( data[953], data[477] );
            std::swap( data[1976], data[478] );
            std::swap( data[1977], data[479] );
            std::swap( data[1144], data[482] );
            std::swap( data[1145], data[483] );
            std::swap( data[632], data[484] );
            std::swap( data[633], data[485] );
            std::swap( data[1656], data[486] );
            std::swap( data[1657], data[487] );
            std::swap( data[1400], data[490] );
            std::swap( data[1401], data[491] );
            std::swap( data[888], data[492] );
            std::swap( data[889], data[493] );
            std::swap( data[1912], data[494] );
            std::swap( data[1913], data[495] );
            std::swap( data[1272], data[498] );
            std::swap( data[1273], data[499] );
            std::swap( data[760], data[500] );
            std::swap( data[761], data[501] );
            std::swap( data[1784], data[502] );
            std::swap( data[1785], data[503] );
            std::swap( data[1528], data[506] );
            std::swap( data[1529], data[507] );
            std::swap( data[1016], data[508] );
            std::swap( data[1017], data[509] );
            std::swap( data[2040], data[510] );
            std::swap( data[2041], data[511] );
            std::swap( data[1028], data[514] );
            std::swap( data[1029], data[515] );
            std::swap( data[1540], data[518] );
            std::swap( data[1541], data[519] );
            std::swap( data[1284], data[522] );
            std::swap( data[1285], data[523] );
            std::swap( data[772], data[524] );
            std::swap( data[773], data[525] );
            std::swap( data[1796], data[526] );
            std::swap( data[1797], data[527] );
            std::swap( data[1156], data[530] );
            std::swap( data[1157], data[531] );
            std::swap( data[644], data[532] );
            std::swap( data[645], data[533] );
            std::swap( data[1668], data[534] );
            std::swap( data[1669], data[535] );
            std::swap( data[1412], data[538] );
            std::swap( data[1413], data[539] );
            std::swap( data[900], data[540] );
            std::swap( data[901], data[541] );
            std::swap( data[1924], data[542] );
            std::swap( data[1925], data[543] );
            std::swap( data[1092], data[546] );
            std::swap( data[1093], data[547] );
            std::swap( data[580], data[548] );
            std::swap( data[581], data[549] );
            std::swap( data[1604], data[550] );
            std::swap( data[1605], data[551] );
            std::swap( data[1348], data[554] );
            std::swap( data[1349], data[555] );
            std::swap( data[836], data[556] );
            std::swap( data[837], data[557] );
            std::swap( data[1860], data[558] );
            std::swap( data[1861], data[559] );
            std::swap( data[1220], data[562] );
            std::swap( data[1221], data[563] );
            std::swap( data[708], data[564] );
            std::swap( data[709], data[565] );
            std::swap( data[1732], data[566] );
            std::swap( data[1733], data[567] );
            std::swap( data[1476], data[570] );
            std::swap( data[1477], data[571] );
            std::swap( data[964], data[572] );
            std::swap( data[965], data[573] );
            std::swap( data[1988], data[574] );
            std::swap( data[1989], data[575] );
            std::swap( data[1060], data[578] );
            std::swap( data[1061], data[579] );
            std::swap( data[1572], data[582] );
            std::swap( data[1573], data[583] );
            std::swap( data[1316], data[586] );
            std::swap( data[1317], data[587] );
            std::swap( data[804], data[588] );
            std::swap( data[805], data[589] );
            std::swap( data[1828], data[590] );
            std::swap( data[1829], data[591] );
            std::swap( data[1188], data[594] );
            std::swap( data[1189], data[595] );
            std::swap( data[676], data[596] );
            std::swap( data[677], data[597] );
            std::swap( data[1700], data[598] );
            std::swap( data[1701], data[599] );
            std::swap( data[1444], data[602] );
            std::swap( data[1445], data[603] );
            std::swap( data[932], data[604] );
            std::swap( data[933], data[605] );
            std::swap( data[1956], data[606] );
            std::swap( data[1957], data[607] );
            std::swap( data[1124], data[610] );
            std::swap( data[1125], data[611] );
            std::swap( data[1636], data[614] );
            std::swap( data[1637], data[615] );
            std::swap( data[1380], data[618] );
            std::swap( data[1381], data[619] );
            std::swap( data[868], data[620] );
            std::swap( data[869], data[621] );
            std::swap( data[1892], data[622] );
            std::swap( data[1893], data[623] );
            std::swap( data[1252], data[626] );
            std::swap( data[1253], data[627] );
            std::swap( data[740], data[628] );
            std::swap( data[741], data[629] );
            std::swap( data[1764], data[630] );
            std::swap( data[1765], data[631] );
            std::swap( data[1508], data[634] );
            std::swap( data[1509], data[635] );
            std::swap( data[996], data[636] );
            std::swap( data[997], data[637] );
            std::swap( data[2020], data[638] );
            std::swap( data[2021], data[639] );
            std::swap( data[1044], data[642] );
            std::swap( data[1045], data[643] );
            std::swap( data[1556], data[646] );
            std::swap( data[1557], data[647] );
            std::swap( data[1300], data[650] );
            std::swap( data[1301], data[651] );
            std::swap( data[788], data[652] );
            std::swap( data[789], data[653] );
            std::swap( data[1812], data[654] );
            std::swap( data[1813], data[655] );
            std::swap( data[1172], data[658] );
            std::swap( data[1173], data[659] );
            std::swap( data[1684], data[662] );
            std::swap( data[1685], data[663] );
            std::swap( data[1428], data[666] );
            std::swap( data[1429], data[667] );
            std::swap( data[916], data[668] );
            std::swap( data[917], data[669] );
            std::swap( data[1940], data[670] );
            std::swap( data[1941], data[671] );
            std::swap( data[1108], data[674] );
            std::swap( data[1109], data[675] );
            std::swap( data[1620], data[678] );
            std::swap( data[1621], data[679] );
            std::swap( data[1364], data[682] );
            std::swap( data[1365], data[683] );
            std::swap( data[852], data[684] );
            std::swap( data[853], data[685] );
            std::swap( data[1876], data[686] );
            std::swap( data[1877], data[687] );
            std::swap( data[1236], data[690] );
            std::swap( data[1237], data[691] );
            std::swap( data[724], data[692] );
            std::swap( data[725], data[693] );
            std::swap( data[1748], data[694] );
            std::swap( data[1749], data[695] );
            std::swap( data[1492], data[698] );
            std::swap( data[1493], data[699] );
            std::swap( data[980], data[700] );
            std::swap( data[981], data[701] );
            std::swap( data[2004], data[702] );
            std::swap( data[2005], data[703] );
            std::swap( data[1076], data[706] );
            std::swap( data[1077], data[707] );
            std::swap( data[1588], data[710] );
            std::swap( data[1589], data[711] );
            std::swap( data[1332], data[714] );
            std::swap( data[1333], data[715] );
            std::swap( data[820], data[716] );
            std::swap( data[821], data[717] );
            std::swap( data[1844], data[718] );
            std::swap( data[1845], data[719] );
            std::swap( data[1204], data[722] );
            std::swap( data[1205], data[723] );
            std::swap( data[1716], data[726] );
            std::swap( data[1717], data[727] );
            std::swap( data[1460], data[730] );
            std::swap( data[1461], data[731] );
            std::swap( data[948], data[732] );
            std::swap( data[949], data[733] );
            std::swap( data[1972], data[734] );
            std::swap( data[1973], data[735] );
            std::swap( data[1140], data[738] );
            std::swap( data[1141], data[739] );
            std::swap( data[1652], data[742] );
            std::swap( data[1653], data[743] );
            std::swap( data[1396], data[746] );
            std::swap( data[1397], data[747] );
            std::swap( data[884], data[748] );
            std::swap( data[885], data[749] );
            std::swap( data[1908], data[750] );
            std::swap( data[1909], data[751] );
            std::swap( data[1268], data[754] );
            std::swap( data[1269], data[755] );
            std::swap( data[1780], data[758] );
            std::swap( data[1781], data[759] );
            std::swap( data[1524], data[762] );
            std::swap( data[1525], data[763] );
            std::swap( data[1012], data[764] );
            std::swap( data[1013], data[765] );
            std::swap( data[2036], data[766] );
            std::swap( data[2037], data[767] );
            std::swap( data[1036], data[770] );
            std::swap( data[1037], data[771] );
            std::swap( data[1548], data[774] );
            std::swap( data[1549], data[775] );
            std::swap( data[1292], data[778] );
            std::swap( data[1293], data[779] );
            std::swap( data[1804], data[782] );
            std::swap( data[1805], data[783] );
            std::swap( data[1164], data[786] );
            std::swap( data[1165], data[787] );
            std::swap( data[1676], data[790] );
            std::swap( data[1677], data[791] );
            std::swap( data[1420], data[794] );
            std::swap( data[1421], data[795] );
            std::swap( data[908], data[796] );
            std::swap( data[909], data[797] );
            std::swap( data[1932], data[798] );
            std::swap( data[1933], data[799] );
            std::swap( data[1100], data[802] );
            std::swap( data[1101], data[803] );
            std::swap( data[1612], data[806] );
            std::swap( data[1613], data[807] );
            std::swap( data[1356], data[810] );
            std::swap( data[1357], data[811] );
            std::swap( data[844], data[812] );
            std::swap( data[845], data[813] );
            std::swap( data[1868], data[814] );
            std::swap( data[1869], data[815] );
            std::swap( data[1228], data[818] );
            std::swap( data[1229], data[819] );
            std::swap( data[1740], data[822] );
            std::swap( data[1741], data[823] );
            std::swap( data[1484], data[826] );
            std::swap( data[1485], data[827] );
            std::swap( data[972], data[828] );
            std::swap( data[973], data[829] );
            std::swap( data[1996], data[830] );
            std::swap( data[1997], data[831] );
            std::swap( data[1068], data[834] );
            std::swap( data[1069], data[835] );
            std::swap( data[1580], data[838] );
            std::swap( data[1581], data[839] );
            std::swap( data[1324], data[842] );
            std::swap( data[1325], data[843] );
            std::swap( data[1836], data[846] );
            std::swap( data[1837], data[847] );
            std::swap( data[1196], data[850] );
            std::swap( data[1197], data[851] );
            std::swap( data[1708], data[854] );
            std::swap( data[1709], data[855] );
            std::swap( data[1452], data[858] );
            std::swap( data[1453], data[859] );
            std::swap( data[940], data[860] );
            std::swap( data[941], data[861] );
            std::swap( data[1964], data[862] );
            std::swap( data[1965], data[863] );
            std::swap( data[1132], data[866] );
            std::swap( data[1133], data[867] );
            std::swap( data[1644], data[870] );
            std::swap( data[1645], data[871] );
            std::swap( data[1388], data[874] );
            std::swap( data[1389], data[875] );
            std::swap( data[1900], data[878] );
            std::swap( data[1901], data[879] );
            std::swap( data[1260], data[882] );
            std::swap( data[1261], data[883] );
            std::swap( data[1772], data[886] );
            std::swap( data[1773], data[887] );
            std::swap( data[1516], data[890] );
            std::swap( data[1517], data[891] );
            std::swap( data[1004], data[892] );
            std::swap( data[1005], data[893] );
            std::swap( data[2028], data[894] );
            std::swap( data[2029], data[895] );
            std::swap( data[1052], data[898] );
            std::swap( data[1053], data[899] );
            std::swap( data[1564], data[902] );
            std::swap( data[1565], data[903] );
            std::swap( data[1308], data[906] );
            std::swap( data[1309], data[907] );
            std::swap( data[1820], data[910] );
            std::swap( data[1821], data[911] );
            std::swap( data[1180], data[914] );
            std::swap( data[1181], data[915] );
            std::swap( data[1692], data[918] );
            std::swap( data[1693], data[919] );
            std::swap( data[1436], data[922] );
            std::swap( data[1437], data[923] );
            std::swap( data[1948], data[926] );
            std::swap( data[1949], data[927] );
            std::swap( data[1116], data[930] );
            std::swap( data[1117], data[931] );
            std::swap( data[1628], data[934] );
            std::swap( data[1629], data[935] );
            std::swap( data[1372], data[938] );
            std::swap( data[1373], data[939] );
            std::swap( data[1884], data[942] );
            std::swap( data[1885], data[943] );
            std::swap( data[1244], data[946] );
            std::swap( data[1245], data[947] );
            std::swap( data[1756], data[950] );
            std::swap( data[1757], data[951] );
            std::swap( data[1500], data[954] );
            std::swap( data[1501], data[955] );
            std::swap( data[988], data[956] );
            std::swap( data[989], data[957] );
            std::swap( data[2012], data[958] );
            std::swap( data[2013], data[959] );
            std::swap( data[1084], data[962] );
            std::swap( data[1085], data[963] );
            std::swap( data[1596], data[966] );
            std::swap( data[1597], data[967] );
            std::swap( data[1340], data[970] );
            std::swap( data[1341], data[971] );
            std::swap( data[1852], data[974] );
            std::swap( data[1853], data[975] );
            std::swap( data[1212], data[978] );
            std::swap( data[1213], data[979] );
            std::swap( data[1724], data[982] );
            std::swap( data[1725], data[983] );
            std::swap( data[1468], data[986] );
            std::swap( data[1469], data[987] );
            std::swap( data[1980], data[990] );
            std::swap( data[1981], data[991] );
            std::swap( data[1148], data[994] );
            std::swap( data[1149], data[995] );
            std::swap( data[1660], data[998] );
            std::swap( data[1661], data[999] );
            std::swap( data[1404], data[1002] );
            std::swap( data[1405], data[1003] );
            std::swap( data[1916], data[1006] );
            std::swap( data[1917], data[1007] );
            std::swap( data[1276], data[1010] );
            std::swap( data[1277], data[1011] );
            std::swap( data[1788], data[1014] );
            std::swap( data[1789], data[1015] );
            std::swap( data[1532], data[1018] );
            std::swap( data[1533], data[1019] );
            std::swap( data[2044], data[1022] );
            std::swap( data[2045], data[1023] );
            std::swap( data[1538], data[1030] );
            std::swap( data[1539], data[1031] );
            std::swap( data[1282], data[1034] );
            std::swap( data[1283], data[1035] );
            std::swap( data[1794], data[1038] );
            std::swap( data[1795], data[1039] );
            std::swap( data[1154], data[1042] );
            std::swap( data[1155], data[1043] );
            std::swap( data[1666], data[1046] );
            std::swap( data[1667], data[1047] );
            std::swap( data[1410], data[1050] );
            std::swap( data[1411], data[1051] );
            std::swap( data[1922], data[1054] );
            std::swap( data[1923], data[1055] );
            std::swap( data[1090], data[1058] );
            std::swap( data[1091], data[1059] );
            std::swap( data[1602], data[1062] );
            std::swap( data[1603], data[1063] );
            std::swap( data[1346], data[1066] );
            std::swap( data[1347], data[1067] );
            std::swap( data[1858], data[1070] );
            std::swap( data[1859], data[1071] );
            std::swap( data[1218], data[1074] );
            std::swap( data[1219], data[1075] );
            std::swap( data[1730], data[1078] );
            std::swap( data[1731], data[1079] );
            std::swap( data[1474], data[1082] );
            std::swap( data[1475], data[1083] );
            std::swap( data[1986], data[1086] );
            std::swap( data[1987], data[1087] );
            std::swap( data[1570], data[1094] );
            std::swap( data[1571], data[1095] );
            std::swap( data[1314], data[1098] );
            std::swap( data[1315], data[1099] );
            std::swap( data[1826], data[1102] );
            std::swap( data[1827], data[1103] );
            std::swap( data[1186], data[1106] );
            std::swap( data[1187], data[1107] );
            std::swap( data[1698], data[1110] );
            std::swap( data[1699], data[1111] );
            std::swap( data[1442], data[1114] );
            std::swap( data[1443], data[1115] );
            std::swap( data[1954], data[1118] );
            std::swap( data[1955], data[1119] );
            std::swap( data[1634], data[1126] );
            std::swap( data[1635], data[1127] );
            std::swap( data[1378], data[1130] );
            std::swap( data[1379], data[1131] );
            std::swap( data[1890], data[1134] );
            std::swap( data[1891], data[1135] );
            std::swap( data[1250], data[1138] );
            std::swap( data[1251], data[1139] );
            std::swap( data[1762], data[1142] );
            std::swap( data[1763], data[1143] );
            std::swap( data[1506], data[1146] );
            std::swap( data[1507], data[1147] );
            std::swap( data[2018], data[1150] );
            std::swap( data[2019], data[1151] );
            std::swap( data[1554], data[1158] );
            std::swap( data[1555], data[1159] );
            std::swap( data[1298], data[1162] );
            std::swap( data[1299], data[1163] );
            std::swap( data[1810], data[1166] );
            std::swap( data[1811], data[1167] );
            std::swap( data[1682], data[1174] );
            std::swap( data[1683], data[1175] );
            std::swap( data[1426], data[1178] );
            std::swap( data[1427], data[1179] );
            std::swap( data[1938], data[1182] );
            std::swap( data[1939], data[1183] );
            std::swap( data[1618], data[1190] );
            std::swap( data[1619], data[1191] );
            std::swap( data[1362], data[1194] );
            std::swap( data[1363], data[1195] );
            std::swap( data[1874], data[1198] );
            std::swap( data[1875], data[1199] );
            std::swap( data[1234], data[1202] );
            std::swap( data[1235], data[1203] );
            std::swap( data[1746], data[1206] );
            std::swap( data[1747], data[1207] );
            std::swap( data[1490], data[1210] );
            std::swap( data[1491], data[1211] );
            std::swap( data[2002], data[1214] );
            std::swap( data[2003], data[1215] );
            std::swap( data[1586], data[1222] );
            std::swap( data[1587], data[1223] );
            std::swap( data[1330], data[1226] );
            std::swap( data[1331], data[1227] );
            std::swap( data[1842], data[1230] );
            std::swap( data[1843], data[1231] );
            std::swap( data[1714], data[1238] );
            std::swap( data[1715], data[1239] );
            std::swap( data[1458], data[1242] );
            std::swap( data[1459], data[1243] );
            std::swap( data[1970], data[1246] );
            std::swap( data[1971], data[1247] );
            std::swap( data[1650], data[1254] );
            std::swap( data[1651], data[1255] );
            std::swap( data[1394], data[1258] );
            std::swap( data[1395], data[1259] );
            std::swap( data[1906], data[1262] );
            std::swap( data[1907], data[1263] );
            std::swap( data[1778], data[1270] );
            std::swap( data[1779], data[1271] );
            std::swap( data[1522], data[1274] );
            std::swap( data[1523], data[1275] );
            std::swap( data[2034], data[1278] );
            std::swap( data[2035], data[1279] );
            std::swap( data[1546], data[1286] );
            std::swap( data[1547], data[1287] );
            std::swap( data[1802], data[1294] );
            std::swap( data[1803], data[1295] );
            std::swap( data[1674], data[1302] );
            std::swap( data[1675], data[1303] );
            std::swap( data[1418], data[1306] );
            std::swap( data[1419], data[1307] );
            std::swap( data[1930], data[1310] );
            std::swap( data[1931], data[1311] );
            std::swap( data[1610], data[1318] );
            std::swap( data[1611], data[1319] );
            std::swap( data[1354], data[1322] );
            std::swap( data[1355], data[1323] );
            std::swap( data[1866], data[1326] );
            std::swap( data[1867], data[1327] );
            std::swap( data[1738], data[1334] );
            std::swap( data[1739], data[1335] );
            std::swap( data[1482], data[1338] );
            std::swap( data[1483], data[1339] );
            std::swap( data[1994], data[1342] );
            std::swap( data[1995], data[1343] );
            std::swap( data[1578], data[1350] );
            std::swap( data[1579], data[1351] );
            std::swap( data[1834], data[1358] );
            std::swap( data[1835], data[1359] );
            std::swap( data[1706], data[1366] );
            std::swap( data[1707], data[1367] );
            std::swap( data[1450], data[1370] );
            std::swap( data[1451], data[1371] );
            std::swap( data[1962], data[1374] );
            std::swap( data[1963], data[1375] );
            std::swap( data[1642], data[1382] );
            std::swap( data[1643], data[1383] );
            std::swap( data[1898], data[1390] );
            std::swap( data[1899], data[1391] );
            std::swap( data[1770], data[1398] );
            std::swap( data[1771], data[1399] );
            std::swap( data[1514], data[1402] );
            std::swap( data[1515], data[1403] );
            std::swap( data[2026], data[1406] );
            std::swap( data[2027], data[1407] );
            std::swap( data[1562], data[1414] );
            std::swap( data[1563], data[1415] );
            std::swap( data[1818], data[1422] );
            std::swap( data[1819], data[1423] );
            std::swap( data[1690], data[1430] );
            std::swap( data[1691], data[1431] );
            std::swap( data[1946], data[1438] );
            std::swap( data[1947], data[1439] );
            std::swap( data[1626], data[1446] );
            std::swap( data[1627], data[1447] );
            std::swap( data[1882], data[1454] );
            std::swap( data[1883], data[1455] );
            std::swap( data[1754], data[1462] );
            std::swap( data[1755], data[1463] );
            std::swap( data[1498], data[1466] );
            std::swap( data[1499], data[1467] );
            std::swap( data[2010], data[1470] );
            std::swap( data[2011], data[1471] );
            std::swap( data[1594], data[1478] );
            std::swap( data[1595], data[1479] );
            std::swap( data[1850], data[1486] );
            std::swap( data[1851], data[1487] );
            std::swap( data[1722], data[1494] );
            std::swap( data[1723], data[1495] );
            std::swap( data[1978], data[1502] );
            std::swap( data[1979], data[1503] );
            std::swap( data[1658], data[1510] );
            std::swap( data[1659], data[1511] );
            std::swap( data[1914], data[1518] );
            std::swap( data[1915], data[1519] );
            std::swap( data[1786], data[1526] );
            std::swap( data[1787], data[1527] );
            std::swap( data[2042], data[1534] );
            std::swap( data[2043], data[1535] );
            std::swap( data[1798], data[1550] );
            std::swap( data[1799], data[1551] );
            std::swap( data[1670], data[1558] );
            std::swap( data[1671], data[1559] );
            std::swap( data[1926], data[1566] );
            std::swap( data[1927], data[1567] );
            std::swap( data[1606], data[1574] );
            std::swap( data[1607], data[1575] );
            std::swap( data[1862], data[1582] );
            std::swap( data[1863], data[1583] );
            std::swap( data[1734], data[1590] );
            std::swap( data[1735], data[1591] );
            std::swap( data[1990], data[1598] );
            std::swap( data[1991], data[1599] );
            std::swap( data[1830], data[1614] );
            std::swap( data[1831], data[1615] );
            std::swap( data[1702], data[1622] );
            std::swap( data[1703], data[1623] );
            std::swap( data[1958], data[1630] );
            std::swap( data[1959], data[1631] );
            std::swap( data[1894], data[1646] );
            std::swap( data[1895], data[1647] );
            std::swap( data[1766], data[1654] );
            std::swap( data[1767], data[1655] );
            std::swap( data[2022], data[1662] );
            std::swap( data[2023], data[1663] );
            std::swap( data[1814], data[1678] );
            std::swap( data[1815], data[1679] );
            std::swap( data[1942], data[1694] );
            std::swap( data[1943], data[1695] );
            std::swap( data[1878], data[1710] );
            std::swap( data[1879], data[1711] );
            std::swap( data[1750], data[1718] );
            std::swap( data[1751], data[1719] );
            std::swap( data[2006], data[1726] );
            std::swap( data[2007], data[1727] );
            std::swap( data[1846], data[1742] );
            std::swap( data[1847], data[1743] );
            std::swap( data[1974], data[1758] );
            std::swap( data[1975], data[1759] );
            std::swap( data[1910], data[1774] );
            std::swap( data[1911], data[1775] );
            std::swap( data[2038], data[1790] );
            std::swap( data[2039], data[1791] );
            std::swap( data[1934], data[1822] );
            std::swap( data[1935], data[1823] );
            std::swap( data[1870], data[1838] );
            std::swap( data[1871], data[1839] );
            std::swap( data[1998], data[1854] );
            std::swap( data[1999], data[1855] );
            std::swap( data[1966], data[1886] );
            std::swap( data[1967], data[1887] );
            std::swap( data[2030], data[1918] );
            std::swap( data[2031], data[1919] );
            std::swap( data[2014], data[1982] );
            std::swap( data[2015], data[1983] );
        }
    }

    template <std::size_t N>
    inline void fft( float* data )
    {
        detail::danielson_lanczos<N> recursion;
        detail::scramble<N>( data );
        recursion.apply( data );
    }

} // namespace dsp

